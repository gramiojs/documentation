---
title: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram-–±–æ—Ç–æ–≤ ‚Äî Event-driven —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è GramIO

head:
    - - meta
      - name: "description"
        content: "–£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Telegram-–±–æ—Ç–∞ –Ω–∞ GramIO. Event-driven —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏-–∞–∫—Ç–æ—Ä–∞–º–∏, —Å–∏–º—É–ª—è—Ü–∏–µ–π —á–∞—Ç–æ–≤, –º–æ–∫–∞–º–∏ API –∏ –∫–ª–∏–∫–∞–º–∏ –ø–æ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∞–º ‚Äî –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤."

    - - meta
      - name: "keywords"
        content: "telegram –±–æ—Ç, —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞, Telegram, Telegram Bot API, GramIO, TypeScript, JavaScript, Node.JS, Nodejs, Deno, Bun, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–æ–≤, –º–æ–∫ API, —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ, —Å–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–∏–º—É–ª—è—Ü–∏—è —á–∞—Ç–æ–≤, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ callback query, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–æ–∫, –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ API, TelegramTestEnvironment"
---

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

<div class="badges">

[![npm](https://img.shields.io/npm/v/@gramio/test?logo=npm&style=flat&labelColor=000&color=3b82f6)](https://www.npmjs.org/package/@gramio/test)
[![npm downloads](https://img.shields.io/npm/dw/@gramio/test?logo=npm&style=flat&labelColor=000&color=3b82f6)](https://www.npmjs.org/package/@gramio/test)
[![JSR](https://jsr.io/badges/@gramio/test)](https://jsr.io/@gramio/test)
[![JSR Score](https://jsr.io/badges/@gramio/test/score)](https://jsr.io/@gramio/test)

</div>

Event-driven —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–æ—Ç–æ–≤, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –Ω–∞ GramIO. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Äî —ç—Ç–æ –≥–ª–∞–≤–Ω–æ–µ –¥–µ–π—Å—Ç–≤—É—é—â–µ–µ –ª–∏—Ü–æ: –æ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –≤—Ö–æ–¥—è—Ç/–≤—ã—Ö–æ–¥—è—Ç –∏–∑ —á–∞—Ç–æ–≤, –Ω–∞–∂–∏–º–∞—é—Ç –∏–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏, –∞ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤ –ø–∞–º—è—Ç–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–æ—Ç—É –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ Telegram-–∞–ø–¥–µ–π—Ç—ã. –ù–∏–∫–∞–∫–∏—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

::: code-group

```bash [npm]
npm install -D @gramio/test
```

```bash [yarn]
yarn add -D @gramio/test
```

```bash [pnpm]
pnpm add -D @gramio/test
```

```bash [bun]
bun add -d @gramio/test
```

:::

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```ts
import { describe, expect, it } from "bun:test";
import { Bot } from "gramio";
import { TelegramTestEnvironment } from "@gramio/test";

describe("My bot", () => {
    it("should reply to /start", async () => {
        const bot = new Bot("test");
        bot.command("start", (ctx) => ctx.send("Welcome!"));

        const env = new TelegramTestEnvironment(bot);
        const user = env.createUser({ first_name: "Alice" });

        await user.sendMessage("/start");

        expect(env.apiCalls[0].method).toBe("sendMessage");
    });
});
```

## `TelegramTestEnvironment`

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä. –û–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç GramIO `Bot`, –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏—Å—Ö–æ–¥—è—â–∏–µ API-–≤—ã–∑–æ–≤—ã –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ–∞–±—Ä–∏–∫–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —á–∞—Ç–æ–≤.

```ts
const bot = new Bot("test");
const env = new TelegramTestEnvironment(bot);
```

| –°–≤–æ–π—Å—Ç–≤–æ / –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| `env.createUser(payload?)` | –°–æ–∑–¥–∞—ë—Ç `UserObject`, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é |
| `env.createChat(payload?)` | –°–æ–∑–¥–∞—ë—Ç `ChatObject` (–≥—Ä—É–ø–ø–∞, —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞, –∫–∞–Ω–∞–ª –∏ —Ç.–¥.) |
| `env.emitUpdate(update)` | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—ã—Ä–æ–π `TelegramUpdate` –∏–ª–∏ `MessageObject` –±–æ—Ç—É |
| `env.onApi(method, handler)` | –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ API-–º–µ—Ç–æ–¥–∞ |
| `env.offApi(method?)` | –£–¥–∞–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ (–∏–ª–∏ –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –µ—Å–ª–∏ –º–µ—Ç–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω) |
| `env.apiCalls` | –ú–∞—Å—Å–∏–≤ `{ method, params, response }` ‚Äî –ª–æ–≥ –≤—Å–µ—Ö API-–≤—ã–∑–æ–≤–æ–≤ |
| `env.clearApiCalls()` | –û—á–∏—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ `apiCalls` (–ø–æ–ª–µ–∑–Ω–æ –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏ —Ç–µ—Å—Ç–∞) |
| `env.lastApiCall(method)` | –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è `method`, –∏–ª–∏ `undefined` |
| `env.users` / `env.chats` | –í—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ —á–∞—Ç—ã |

## `UserObject` ‚Äî –≥–ª–∞–≤–Ω–æ–µ –¥–µ–π—Å—Ç–≤—É—é—â–µ–µ –ª–∏—Ü–æ

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç —Ç–µ—Å—Ç–æ–≤—ã–º —Å—Ü–µ–Ω–∞—Ä–∏–µ–º. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ `env.createUser()`:

```ts
const user = env.createUser({ first_name: "Alice" });
```

### `user.sendMessage(text)` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –õ–° –±–æ—Ç—É

```ts
const msg = await user.sendMessage("Hello");
```

### `user.sendMessage(chat, text)` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É

```ts
const group = env.createChat({ type: "group", title: "Test Group" });
await user.sendMessage(group, "/start");
```

### `user.join(chat)` / `user.leave(chat)`

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–ø–¥–µ–π—Ç `chat_member` –∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (`new_chat_members` / `left_chat_member`). –û–±–Ω–æ–≤–ª—è–µ—Ç `chat.members`.

```ts
await user.join(group);
expect(group.members.has(user)).toBe(true);

await user.leave(group);
expect(group.members.has(user)).toBe(false);
```

### `user.click(callbackData, message?)`

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–ø–¥–µ–π—Ç `callback_query`. –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä:

```ts
const msg = await user.sendMessage("Pick an option");
await user.click("option:1", msg);
```

### `user.editMessage(msg, text)` ‚Äî —ç–º—É–ª—è—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–ø–¥–µ–π—Ç `edited_message`. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `bot.on("edited_message", ...)`:

```ts
const msg = await user.sendMessage("–ü—Ä–∏–≤–µ—Ç");
await user.editMessage(msg, "–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!");
```

### `user.forwardMessage(msg, toChat?)` ‚Äî –ø–µ—Ä–µ—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–ø–¥–µ–π—Ç `message` —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º `forward_origin`. –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ—Å—ã–ª–æ–∫:

```ts
const msg = await user.sendMessage("–û—Ä–∏–≥–∏–Ω–∞–ª");
await user.forwardMessage(msg, group);
```

### `user.sendMediaGroup(chat, payloads[])` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª—å–±–æ–º–∞

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–ø–¥–µ–π—Ç–æ–≤ `message` —Å –æ–¥–Ω–∏–º `media_group_id`:

```ts
await user.sendMediaGroup(group, [
    { photo: {} },
    { video: {} },
]);
```

### `user.pinMessage(msg, inChat?)` ‚Äî –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É–∂–µ–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å `pinned_message`. GramIO –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ —Å–æ–±—ã—Ç–∏–µ `"pinned_message"`:

```ts
const msg = await user.sendMessage("–í–∞–∂–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ");
await user.pinMessage(msg);
```

### –ú–µ–¥–∏–∞-–º–µ—Ç–æ–¥—ã

–ü–æ–º–∏–º–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–µ—Ç–æ–¥–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—ã —Ç—Ä–∏ –Ω–æ–≤—ã—Ö ‚Äî —Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π `file_id`:

```ts
await user.sendAudio({ caption: "–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞" });
await user.sendAnimation(group, { caption: "–ì–∏—Ñ–∫–∞" });
await user.sendVideoNote(); // –∫—Ä—É–∂–æ—á–µ–∫
```

### `user.react(emojiOrObject, message?, options?)` ‚Äî —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–ø–¥–µ–π—Ç `message_reaction`. –†–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ `bot.reaction()`:

```ts
const msg = await user.sendMessage("–•–æ—Ä–æ—à–∏–π –±–æ—Ç!");

// –û–¥–∏–Ω —ç–º–æ–¥–∑–∏
await user.react("üëç", msg);

// –ù–µ—Å–∫–æ–ª—å–∫–æ —ç–º–æ–¥–∑–∏
await user.react(["üëç", "‚ù§"], msg);

// –û–±—ä—è–≤–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∞–∫—Ü–∏–∏ (old_reaction)
await user.react("‚ù§", msg, { oldReactions: ["üëç"] });
```

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ReactObject` –¥–ª—è —Ç–æ–Ω–∫–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è:

```ts
import { ReactObject } from "@gramio/test";

await user.react(
    new ReactObject()
        .on(msg)          // –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é (—á–∞—Ç –≤—ã–≤–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        .add("üëç", "üî•") // new_reaction
        .remove("üò¢")    // old_reaction
);
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–π**: `MessageObject` –≤–µ–¥—ë—Ç —Ä–µ–∞–∫—Ü–∏–∏ –≤ –ø–∞–º—è—Ç–∏. `old_reaction` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `user.react()`.

### `user.sendInlineQuery(query, chatOrOptions?, options?)` ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å inline-—Ä–µ–∂–∏–º

```ts
const q = await user.sendInlineQuery("–ø–æ–∏—Å–∫ –∫–æ—à–µ–∫");
const group = env.createChat({ type: "group" });
const q2 = await user.sendInlineQuery("–ø–æ–∏—Å–∫ –∫–æ—à–µ–∫", group); // chat_type: "group"
```

### `user.chooseInlineResult(resultId, query, options?)` ‚Äî –≤—ã–±—Ä–∞—Ç—å inline-—Ä–µ–∑—É–ª—å—Ç–∞—Ç

```ts
await user.chooseInlineResult("result-1", "–ø–æ–∏—Å–∫ –∫–æ—à–µ–∫");
```

### `user.in(chat)` / `user.on(msg)` ‚Äî fluent-—Å–∫–æ—É–ø—ã

```ts
// –°–∫–æ—É–ø –∫ —á–∞—Ç—É
await user.in(group).sendMessage("–ü—Ä–∏–≤–µ—Ç!");
await user.in(group).join();
await user.in(group).on(msg).react("üî•");

// –°–∫–æ—É–ø –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
await user.on(msg).react("üëç");
await user.on(msg).click("action:1");

// clickByText ‚Äî –Ω–∞–π—Ç–∏ –∫–Ω–æ–ø–∫—É –ø–æ —Ç–µ–∫—Å—Ç—É –∏ –Ω–∞–∂–∞—Ç—å
await user.on(botReply).clickByText("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å");
```

`clickByText(buttonText)` –∏—â–µ—Ç –≤ `inline_keyboard` –∫–Ω–æ–ø–∫—É —Å –Ω—É–∂–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –µ—ë `callback_data`. –í—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –Ω–µ—Ç –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.

## `ChatObject`

–û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ `TelegramChat` —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏:

- **`chat.members`** ‚Äî `Set<UserObject>` —Ç–µ–∫—É—â–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- **`chat.messages`** ‚Äî `MessageObject[]` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ

### `chat.post(text)` ‚Äî —Å–∏–º—É–ª—è—Ü–∏—è –ø–æ—Å—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–ø–¥–µ–π—Ç `channel_post` (–±–µ–∑ –ø–æ–ª—è `from`). –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–æ—Ç–æ–≤ –≤ –∫–∞–Ω–∞–ª–∞—Ö:

```ts
const channel = env.createChat({ type: "channel", title: "–ú–æ–π –∫–∞–Ω–∞–ª" });
await channel.post("–ù–æ–≤—ã–π –ø–æ—Å—Ç");
```

## `MessageObject`

–û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ `TelegramMessage` —Å –±–∏–ª–¥–µ—Ä-–º–µ—Ç–æ–¥–∞–º–∏:

```ts
const message = new MessageObject({ text: "Hello" })
    .from(user)
    .chat(group);
```

## `CallbackQueryObject`

–û–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ `TelegramCallbackQuery` —Å –±–∏–ª–¥–µ—Ä-–º–µ—Ç–æ–¥–∞–º–∏:

```ts
const cbQuery = new CallbackQueryObject()
    .from(user)
    .data("action:1")
    .message(msg);
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ API-–≤—ã–∑–æ–≤–æ–≤ –±–æ—Ç–∞

–û–∫—Ä—É–∂–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏—Å—Ö–æ–¥—è—â–∏–µ API-–≤—ã–∑–æ–≤—ã (–Ω–∏–∫–∞–∫–∏—Ö —Ä–µ–∞–ª—å–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤) –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö:

```ts
const bot = new Bot("test");
bot.on("message", async (ctx) => {
    await ctx.send("Reply!");
});

const env = new TelegramTestEnvironment(bot);
const user = env.createUser();

await user.sendMessage("Hello");

expect(env.apiCalls).toHaveLength(1);
expect(env.apiCalls[0].method).toBe("sendMessage");
expect(env.apiCalls[0].params.text).toBe("Reply!");
```

## –ü–æ–¥–º–µ–Ω–∞ –æ—Ç–≤–µ—Ç–æ–≤ API

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `env.onApi()`, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–º, —á—Ç–æ –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç Telegram API. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫:

```ts
// Static response
env.onApi("getMe", { id: 1, is_bot: true, first_name: "TestBot" });

// Dynamic response based on params
env.onApi("sendMessage", (params) => ({
    message_id: 1,
    date: Date.now(),
    chat: { id: params.chat_id, type: "private" },
    text: params.text,
}));
```

### –°–∏–º—É–ª—è—Ü–∏—è –æ—à–∏–±–æ–∫

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `apiError()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è `TelegramError`, –∫–æ—Ç–æ—Ä—ã–π –±–æ—Ç –ø–æ–ª—É—á–∏—Ç –∫–∞–∫ rejected –ø—Ä–æ–º–∏—Å ‚Äî –≤ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–µ –æ—à–∏–±–∫–∏ Telegram API —Ä–∞–±–æ—Ç–∞—é—Ç –≤ GramIO:

```ts
import { TelegramTestEnvironment, apiError } from "@gramio/test";

// Bot is blocked by user
env.onApi("sendMessage", apiError(403, "Forbidden: bot was blocked by the user"));

// Rate limiting
env.onApi("sendMessage", apiError(429, "Too Many Requests", { retry_after: 30 }));

// Conditional ‚Äî error for some chats, success for others
env.onApi("sendMessage", (params) => {
    if (params.chat_id === blockedUserId) {
        return apiError(403, "Forbidden: bot was blocked by the user");
    }
    return {
        message_id: 1,
        date: Date.now(),
        chat: { id: params.chat_id, type: "private" },
        text: params.text,
    };
});
```

### –°–±—Ä–æ—Å

```ts
env.offApi("sendMessage"); // reset specific method
env.offApi();              // reset all overrides
```

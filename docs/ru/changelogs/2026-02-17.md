---
title: "GramIO v0.5.0 ‚Äî –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Composer, –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ —Å—É–ø–µ—Ä—Å–∏–ª—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"
head:
    - - meta
      - name: "description"
        content: "GramIO v0.5.0 –∑–∞–º–µ–Ω—è–µ—Ç middleware-io –Ω–∞ @gramio/composer, –¥–æ–±–∞–≤–ª—è–µ—Ç decorate(), when(), inspect(), trace(), @gramio/test v0.1.0 –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∞–∫—Ü–∏–∏ –∏ fluent-—Å–∫–æ—É–ø—ã, –∞ @gramio/session v0.2.0 ‚Äî –ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Å—Å–∏–π."
    - - meta
      - name: "keywords"
        content: "gramio, changelog, v0.5.0, composer, decorate, when, inspect, trace, testing, reactions, inline queries, scenes, storages, session, lazy sessions, sqlite"
---

# GramIO v0.5.0 ‚Äî –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Composer, –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ —Å—É–ø–µ—Ä—Å–∏–ª—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**16‚Äì18 —Ñ–µ–≤—Ä–∞–ª—è 2026**

–ë–æ–ª—å—à–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–π —Ü–∏–∫–ª. –ì–ª–∞–≤–Ω–æ–µ: `gramio` v0.5.0 –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ –∏–∑–±–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç `middleware-io` –∏ —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ `@gramio/composer` v0.2.0 ‚Äî —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ middleware —Å –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å—é, —É—Å–ª–æ–≤–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–æ–≥–∞—â–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ `@gramio/test` –¥–æ—Ö–æ–¥–∏—Ç –¥–æ v0.1.0 —Å —Ä–µ–∞–∫—Ü–∏—è–º–∏, inline-–∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ fluent-—Å–∫–æ—É–ø–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç —Ç–µ—Å—Ç—ã —á–∏—Ç–∞–µ–º—ã–º–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.

## [gramio v0.5.0 ‚Äî –ü—Ä–æ—â–∞–π, middleware-io](https://github.com/gramiojs/gramio/compare/v0.4.14...v0.5.0)

### [–Ø–¥—Ä–æ middleware –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –Ω–∞ @gramio/composer](https://github.com/gramiojs/gramio/commit/c129fae1e953afa9fd42566386a8be272b723c47)

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `middleware-io` —É–¥–∞–ª–µ–Ω–∞. GramIO —Ç–µ–ø–µ—Ä—å –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `@gramio/composer` ‚Äî —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ª—É—á—à—É—é –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é, –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ middleware –¥–ª—è —á–∏—Ç–∞–µ–º—ã—Ö —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–æ–≤ –∏ –Ω–æ–≤—ã–π API –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ (`inspect()`, `trace()`).

–ö–ª–∞—Å—Å `UpdateQueue` –∏–∑ `src/queue.ts` —Ç–∞–∫–∂–µ —É–¥–∞–ª—ë–Ω ‚Äî –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ `EventQueue` –∏–∑ `@gramio/composer`.

### [–ú–µ—Ç–æ–¥—ã-—Ö–µ–ª–ø–µ—Ä—ã –ø–µ—Ä–µ–µ—Ö–∞–ª–∏ –≤ Composer ‚Äî –ø–ª–∞–≥–∏–Ω—ã —Ç–æ–∂–µ –º–æ–≥—É—Ç –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å](https://github.com/gramiojs/gramio/commit/58b0aaa0c2e7e6c6b6562820378c9e3b22b14153)

`reaction()`, `callbackQuery()`, `chosenInlineResult()`, `inlineQuery()`, `hears()`, `command()` –∏ `startParameter()` –ø–µ—Ä–µ–µ—Ö–∞–ª–∏ –∏–∑ `Bot` –≤ `Composer`. –ú–µ—Ç–æ–¥—ã –Ω–∞ `Bot` –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –µ—Å—Ç—å ‚Äî –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–µ–≥–∏—Ä—É—é—Ç –≤ –∫–æ–º–ø–æ–∑–µ—Ä. –ó–∞—Ç–æ —Ç–µ–ø–µ—Ä—å –ø–ª–∞–≥–∏–Ω—ã –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–∑–µ—Ä—ã —Ç–æ–∂–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Ö–µ–ª–ø–µ—Ä—ã –Ω–∞–ø—Ä—è–º—É—é:

```ts
// –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ –ø–ª–∞–≥–∏–Ω–∞, –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ Bot:
const myPlugin = new Plugin("my-plugin")
    .command("help", (ctx) => ctx.send("–ü–æ–º–æ—â—å!"))
    .hears(/–ø—Ä–∏–≤–µ—Ç/i, (ctx) => ctx.send("–ü—Ä–∏–≤–µ—Ç!"));
```

### [–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∏ Bot.extend(composer) –∏ Plugin.extend(composer)](https://github.com/gramiojs/gramio/commit/2d65314)

`Bot` –∏ `Plugin` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞—é—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä—ã `EventComposer` –≤ `extend()` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º —Ç–∏–ø–æ–≤. –ü–ª–∞–≥–∏–Ω–Ω—ã–µ –∫–æ–º–ø–æ–∑–µ—Ä—ã –ø–µ—Ä–µ–≤–æ–¥—è—Ç—Å—è –≤ —Ä–µ–∂–∏–º "scoped" –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —à–∞—Ä–∏–Ω–≥–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è middleware.

### [@gramio/types 9.4.1 –∏ @gramio/composer 0.2.0](https://github.com/gramiojs/gramio/commit/58b0aaa0c2e7e6c6b6562820378c9e3b22b14153)

–û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `@gramio/types` ‚Üí 9.4.1, `@gramio/composer` ‚Üí 0.2.0.

---

## [@gramio/composer v0.2.0 ‚Äî Decorate, When, Inspect, Trace](https://github.com/gramiojs/composer/compare/v0.1.1...v0.2.0)

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–ª—É—á–∏–ª–∞ —Ö–æ—Ä–æ—à–∏–π —Å–ø—Ä–∏–Ω—Ç –ø–æ —Ñ–∏—á–∞–º.

### [decorate() ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–µ–∑ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤](https://github.com/gramiojs/composer/commit/16eb20c46cbc635fbbec4b0e62f0243809a93366)

`derive()` –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å. `decorate()` –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ middleware –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ —Å—Å—ã–ª–∫—É. –ù–∏–∫–∞–∫–∏—Ö –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –≤ —Ä–∞–Ω—Ç–∞–π–º–µ:

```ts
const app = new Composer()
    .decorate({ db: myDbClient, config: appConfig })
    .use((ctx, next) => {
        ctx.db.query(/* ... */); // –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
        return next();
    });
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—É –∂–µ —Å–∏—Å—Ç–µ–º—É —Å–∫–æ—É–ø–æ–≤, —á—Ç–æ –∏ `derive()` ‚Äî –ø–µ—Ä–µ–¥–∞–π—Ç–µ `{ as: "scoped" }` –∏–ª–∏ `{ as: "global" }` –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–ø–æ–∑–µ—Ä—ã —á–µ—Ä–µ–∑ `extend()`.

### [when() ‚Äî —É—Å–ª–æ–≤–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è middleware –Ω–∞ —ç—Ç–∞–ø–µ –∑–∞–ø—É—Å–∫–∞](https://github.com/gramiojs/composer/commit/16eb20c46cbc635fbbec4b0e62f0243809a93366)

–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ middleware —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –∏—Å—Ç–∏–Ω–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ä–∞–Ω—Ç–∞–π–º–æ–≤–æ–≥–æ `branch()`, `when()` –≤—ã—á–∏—Å–ª—è–µ—Ç —É—Å–ª–æ–≤–∏–µ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ. –°–≤–æ–π—Å—Ç–≤–∞, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ `when()`, —Ç–∏–ø–∏–∑–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ `Partial` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ):

```ts
const bot = new Bot(token)
    .when(process.env.NODE_ENV !== "production", (c) =>
        c.use(verboseLogger)
    )
    .when(config.features.auth, (c) =>
        c.derive(() => ({ user: getUser() }))
    )
    .on("message", (ctx) => {
        ctx.user; // —Ç–∏–ø: User | undefined (–º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å, –µ—Å–ª–∏ —Ñ–∏—á–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞)
    });
```

–í–ª–æ–∂–µ–Ω–Ω—ã–µ `when()` —Ä–∞–±–æ—Ç–∞—é—Ç. –ö–ª—é—á–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –∏–∑ —É—Å–ª–æ–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞ –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è.

### [inspect() ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö middleware](https://github.com/gramiojs/composer/commit/08f764325d42938766c4822cb98ebe5849b6f292)

–ü–æ–ª—É—á–∏—Ç–µ –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö middleware –∏ –∏—Ö –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è:

```ts
const app = new Composer()
    .derive(function getUser() { return { user: "alice" }; })
    .guard(function isAdmin() { return true; })
    .use(async function handleRequest(_, next) { return next(); });

app.inspect();
// [
//   { index: 0, type: "derive", name: "getUser", scope: "local" },
//   { index: 1, type: "guard", name: "isAdmin", scope: "local" },
//   { index: 2, type: "use", name: "handleRequest", scope: "local" },
// ]
```

–ü—Ä–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞ –ø–æ–ª–µ `plugin` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫:

```ts
const auth = new Composer({ name: "auth" })
    .derive(function getUser() { return { user: "alice" }; })
    .as("scoped");

new Composer().extend(auth).inspect();
// [{ index: 0, type: "derive", name: "getUser", scope: "local", plugin: "auth" }]
```

### [trace() ‚Äî opt-in –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ middleware](https://github.com/gramiojs/composer/commit/08f764325d42938766c4822cb98ebe5849b6f292)

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ OpenTelemetry, Datadog –∏–ª–∏ –ª—é–±—É—é —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –æ–¥–Ω–∏–º –∫–æ–ª–ª–±–µ–∫–æ–º. –ö–æ–≥–¥–∞ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚Äî –Ω—É–ª–µ–≤—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã:

```ts
const app = new Composer()
    .derive(function getUser() { /* ... */ })
    .use(handler)
    .trace((entry, ctx) => {
        const span = tracer.startSpan(`${entry.type}:${entry.name}`);
        return (error) => {
            if (error) span.recordException(error);
            span.end();
        };
    });
```

–ö–æ–ª–ª–±–µ–∫ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ middleware —É–ø–∞–ª–æ, ‚Äî –ø–æ—Å–ª–µ —á–µ–≥–æ –æ—à–∏–±–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—Ä–æ–±—Ä–æ—Å –≤ `onError`.

### [–ö–æ–Ω—Ñ–∏–≥ methods –¥–ª—è createComposer()](https://github.com/gramiojs/composer/commit/9611bb5)

–ê–≤—Ç–æ—Ä—ã —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ –º–æ–≥—É—Ç –∏–Ω–∂–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã-—Ö–µ–ª–ø–µ—Ä—ã –ø—Ä—è–º–æ –≤ –ø—Ä–æ—Ç–æ—Ç–∏–ø `Composer` —á–µ—Ä–µ–∑ –æ–ø—Ü–∏—é `methods`. –ò–º–µ–Ω–Ω–æ —Ç–∞–∫ –≤ GramIO —Ç–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã `hears()`, `command()`, `reaction()` –∏ –ø—Ä–æ—á–∏–µ:

```ts
const { Composer } = createComposer({
    discriminator: (ctx) => ctx.updateType,
    types: eventTypes<{ message: MessageCtx }>(),
    methods: {
        hears(trigger: RegExp | string, handler: (ctx: MessageCtx) => unknown) {
            return this.on("message", (ctx, next) => {
                const text = ctx.text;
                if (typeof trigger === "string" ? text === trigger : trigger.test(text ?? ""))
                    return handler(ctx);
                return next();
            });
        },
    },
});

// –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –≤—Å–µ —Ü–µ–ø–æ—á–∫–∏:
bot.hears(/hello/, h1).on("message", h2).hears(/bye/, h3); // —Ä–∞–±–æ—Ç–∞–µ—Ç
```

–†–∞–Ω—Ç–∞–π–º–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –±—Ä–æ—Å–∞–µ—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –∏–º—è –º–µ—Ç–æ–¥–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º (`on`, `use`, `derive` –∏ —Ç.–¥.).

### [–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–æ–≤](https://github.com/gramiojs/composer/commit/08f764325d42938766c4822cb98ebe5849b6f292)

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—ë—Ä—Ç–∫–∏, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –º–µ—Ç–æ–¥–∞–º–∏ Composer, —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—é—Ç –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ —á–µ—Ä–µ–∑ `Object.defineProperty`. –§–æ—Ä–º–∞—Ç: `type:handlerName`. –ü—Ä–∏–º–µ—Ä—ã: `derive:getUser`, `guard:isAdmin`, `on:message`. `use()` –Ω–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –≤ —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–∞—Ö.

### [cleanErrorStack() —á–∏—Å—Ç–∏—Ç —Å—Ç–µ–∫—Ç—Ä–µ–π—Å—ã](https://github.com/gramiojs/composer/commit/07de732)

–ù–æ–≤–∞—è —É—Ç–∏–ª–∏—Ç–∞ `cleanErrorStack()` —É–¥–∞–ª—è–µ—Ç —Ñ—Ä–µ–π–º—ã —Å–∞–º–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–∑ —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–æ–≤. –ö–æ–≥–¥–∞ –≤–∞—à –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–∞–¥–∞–µ—Ç ‚Äî –≤ —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–µ –≤–∏–¥–µ–Ω –≤–∞—à –∫–æ–¥, –∞ –Ω–µ –∫–∏—à–∫–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞.

### [MaybeArray —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç readonly-–º–∞—Å—Å–∏–≤—ã](https://github.com/gramiojs/composer/commit/a9f0320)

`MaybeArray<T>` –∏–∑–º–µ–Ω–∏–ª—Å—è —Å `T | T[]` –Ω–∞ `T | readonly T[]`. `as const`-–º–∞—Å—Å–∏–≤—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ —è–≤–Ω—ã—Ö –∫–∞—Å—Ç–æ–≤.

---

## [@gramio/test v0.1.0 ‚Äî –†–µ–∞–∫—Ü–∏–∏, Inline-–∑–∞–ø—Ä–æ—Å—ã –∏ Fluent-—Å–∫–æ—É–ø—ã](https://github.com/gramiojs/test/compare/v0.0.2...v0.1.0)

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—Ä–∞—Å—Ç–∞–µ—Ç –∏–∑ `0.0.x` –¥–æ `0.1.0` —Å –±–æ–ª—å—à–∏–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º API.

### [user.react() ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–µ–∞–∫—Ü–∏–π](https://github.com/gramiojs/test/commit/7910262bdef296dd7c4ee9e56a810779f83c033d)

–≠–º–∏—Ç–∏—Ä—É–π—Ç–µ `message_reaction` –∞–ø–¥–µ–π—Ç—ã –≤ —Ç–µ—Å—Ç–∞—Ö. –†–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ `bot.reaction()`:

```ts
const msg = await user.sendMessage("–•–æ—Ä–æ—à–∏–π –±–æ—Ç!");

// –û–¥–∏–Ω —ç–º–æ–¥–∑–∏
await user.react("üëç", msg);

// –ù–µ—Å–∫–æ–ª—å–∫–æ
await user.react(["üëç", "‚ù§"], msg);

// –°–º–µ–Ω–∞ —Ä–µ–∞–∫—Ü–∏–∏
await user.react("‚ù§", msg, { oldReactions: ["üëç"] });
```

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ReactObject` –¥–ª—è –±–æ–ª–µ–µ —Ç–æ–Ω–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```ts
await user.react(
    new ReactObject()
        .on(msg)          // –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é (—á–∞—Ç –≤—ã–≤–æ–¥–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        .add("üëç", "üî•") // new_reaction
        .remove("üò¢")    // old_reaction
);
```

### [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–π –≤ MessageObject](https://github.com/gramiojs/test/commit/bf55f6a)

`MessageObject` —Ç–µ–ø–µ—Ä—å –≤–µ–¥—ë—Ç `Map` —Ä–µ–∞–∫—Ü–∏–π –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º. –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `user.react()` –ø–æ–ª–µ `old_reaction` –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –ø–∞–º—è—Ç–∏ ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –æ–±—ä—è–≤–ª—è—Ç—å –µ–≥–æ –≤—Ä—É—á–Ω—É—é:

```ts
await user.react("üëç", msg);  // –¥–æ–±–∞–≤–ª—è–µ—Ç üëç, old_reaction = []
await user.react("‚ù§", msg);  // –¥–æ–±–∞–≤–ª—è–µ—Ç ‚ù§, old_reaction = ["üëç"] ‚Äî –≤—ã—á–∏—Å–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
```

### [user.sendInlineQuery() ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ inline-—Ä–µ–∂–∏–º](https://github.com/gramiojs/test/commit/7910262bdef296dd7c4ee9e56a810779f83c033d)

```ts
const q = await user.sendInlineQuery("–ø–æ–∏—Å–∫ –∫–æ—à–µ–∫");
const q2 = await user.sendInlineQuery("–ø–æ–∏—Å–∫ –∫–æ—à–µ–∫", group); // chat_type: "group"
const q3 = await user.sendInlineQuery("–ø–æ–∏—Å–∫ —Å–æ–±–∞–∫", { offset: "10" });
```

### [user.chooseInlineResult() ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ chosen_inline_result](https://github.com/gramiojs/test/commit/7910262bdef296dd7c4ee9e56a810779f83c033d)

```ts
await user.chooseInlineResult("result-1", "–ø–æ–∏—Å–∫ –∫–æ—à–µ–∫");
await user.chooseInlineResult("result-1", "–ø–æ–∏—Å–∫ –∫–æ—à–µ–∫", { inline_message_id: "abc" });
```

### [Fluent-—Å–∫–æ—É–ø—ã ‚Äî user.in(chat) –∏ user.on(msg)](https://github.com/gramiojs/test/commit/7910262bdef296dd7c4ee9e56a810779f83c033d)

–î–≤–∞ –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–∞ –¥–µ–ª–∞—é—Ç —Ç–µ—Å—Ç—ã —á–∏—Ç–∞–µ–º—ã–º–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

```ts
// user.in(chat) ‚Äî –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è –∫ —á–∞—Ç—É
await user.in(group).sendMessage("–ü—Ä–∏–≤–µ—Ç");
await user.in(group).sendInlineQuery("–∫–æ—à–∫–∏");
await user.in(group).join();
await user.in(group).leave();

// user.on(msg) ‚Äî –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏—è –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
await user.on(msg).react("üëç");
await user.on(msg).click("action:1");

// –¶–µ–ø–æ—á–∫–∏ –∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç—Å—è:
await user.in(group).on(msg).react("üî•");
await user.in(group).on(msg).click("–≤—ã–±–æ—Ä:A");
```

–ù–æ–≤—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ã: `ReactObject`, `InlineQueryObject`, `ChosenInlineResultObject`, `UserInChatScope`, `UserOnMessageScope`.

---

## [@gramio/scenes ‚Äî onInvalidInput –¥–ª—è ask()](https://github.com/gramiojs/scenes/commit/52c517c545d2c6457decbc73b25b842411eb8f89)

–ú–µ—Ç–æ–¥ `ask()` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–ø—Ü–∏—é `onInvalidInput` ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ:

```ts
const scene = new Scene("registration")
    .ask(
        "age",
        z.coerce.number().min(18),
        "–°–∫–æ–ª—å–∫–æ –≤–∞–º –ª–µ—Ç?",
        {
            onInvalidInput: async (context, error) => {
                await context.send(`‚ùå ${error.message}\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.`);
            }
        }
    );
```

–¢–∞–∫–∂–µ: `users_shared` –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π, peer-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ `gramio >= 0.5.0`, `@gramio/storage` bumped –¥–æ `^2.0.0`.

---

## [@gramio/storages ‚Äî –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ (v2.0.1)](https://github.com/gramiojs/storages/commit/fc2303f)

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Storage` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∂–µ–Ω–µ—Ä–∏–∫ `Data` —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ (`get`, `set`, `has`, `delete`). –í—Å–µ –∞–¥–∞–ø—Ç–µ—Ä—ã —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ `String()` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

–í–µ—Ä—Å–∏–∏:
- `@gramio/storage` ‚Üí **2.0.1**
- `@gramio/storage-redis` ‚Üí **1.0.5**
- `@gramio/storage-cloudflare` ‚Üí **0.0.2**
- `@gramio/storage-sqlite` ‚Üí **0.0.2**

### [–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Ä–∞–Ω—Ç–∞–π–º–æ–≤ –≤ @gramio/storage-sqlite](https://github.com/gramiojs/storages/commit/bb966f5)

–ê–¥–∞–ø—Ç–µ—Ä SQLite —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ **Bun –∏ Node.js**. –ü–∞–π–ø–ª–∞–π–Ω `prepublishOnly` –ø—Ä–æ–≥–æ–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤, —Å–±–æ—Ä–∫—É –∏ —Ç–µ—Å—Ç—ã –Ω–∞ –æ–±–æ–∏—Ö —Ä–∞–Ω—Ç–∞–π–º–∞—Ö –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π. README –æ–±–Ω–æ–≤–ª—ë–Ω —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ä–µ–¥—ã.

---

## [@gramio/session v0.2.0 ‚Äî –õ–µ–Ω–∏–≤—ã–µ —Å–µ—Å—Å–∏–∏ –∏ –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](https://github.com/gramiojs/session/commit/8c6605b)

### [–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Å—Å–∏–π](https://github.com/gramiojs/session/commit/8c6605b)

–°–µ—Å—Å–∏–∏ —Ç–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏**, –∞ –Ω–µ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥—è—â–µ–º –∞–ø–¥–µ–π—Ç–µ. –≠—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ 50‚Äì90% –¥–ª—è –±–æ—Ç–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Å–µ—Å—Å–∏–µ–π.

```ts
bot.use(session({
    storage: redisStorage,
    lazy: true,
}));
```

–ü—Ä–∏ `lazy: true` –≤—ã–∑–æ–≤ `get` –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –¥–æ –ø–µ—Ä–≤–æ–≥–æ —á—Ç–µ–Ω–∏—è `ctx.session`. –ó–∞–ø–∏—Å—å –æ–±—Ä–∞—Ç–Ω–æ –≤ –∫–æ–Ω—Ü–µ middleware-—Ü–µ–ø–æ—á–∫–∏ –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

### [–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É](https://github.com/gramiojs/session/commit/8c6605b)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ –º–æ–¥—É–ª–∏ –≤ `src/lib/`. –ü—É–±–ª–∏—á–Ω—ã–π API –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Äî —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∏ –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤.

### [–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏](https://github.com/gramiojs/session/commit/bb9b30a)

–î–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–π —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Å–µ—Å—Å–∏–∏, –æ—á–∏—Å—Ç–∫—É —á–µ—Ä–µ–∑ `ctx.session = null`, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–ª—é—á–∏ —Å–µ—Å—Å–∏–π –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.
